<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciar Sesión - AppCheckIn</title>
    <style>
        :root { --background-dark: #121212; --surface-dark: #1e1e1e; --primary-accent: #008cff; --text-primary: #ffffff; --text-secondary: #b3b3b3; --danger-color: #c82333; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; background-color: var(--background-dark); color: var(--text-primary); display: flex; align-items: center; justify-content: center; min-height: 100vh; }
        .login-container { background: var(--surface-dark); padding: 40px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); text-align: center; width: 100%; max-width: 400px; border: 1px solid rgba(255, 255, 255, 0.1); }
        h1 { margin-top: 0; font-size: 2rem; color: var(--primary-accent); }
        input { width: 100%; box-sizing: border-box; padding: 12px; border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.2); background-color: #2a2a2a; color: var(--text-primary); }
        .btn { background-color: var(--primary-accent); color: white; padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; width: 100%; font-size: 1rem; margin-top: 10px; }
        .provider-btn { background: #333; color: white; display: flex; align-items: center; justify-content: center; gap: 10px; padding: 12px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; cursor: pointer; width: 100%; font-size: 0.9rem; margin-top: 10px; }
        .provider-btn img { width: 20px; height: 20px; }
        .divider { text-align: center; margin: 20px 0; color: var(--text-secondary); font-size: 0.9em; }
        #error-message { color: var(--danger-color); margin-top: 15px; min-height: 20px; }
        .footer-links { margin-top: 20px; }
        .footer-links a { color: var(--primary-accent); text-decoration: none; }
    </style>
</head>
<body>
    <div class="login-container">
        <h1>AppCheckIn</h1>
        <div id="error-message"></div>
        <form id="login-form">
            <input type="email" id="email" placeholder="Correo electrónico" required style="margin-bottom: 15px;">
            <input type="password" id="password" placeholder="Contraseña" required>
            <button type="submit" class="btn">Iniciar Sesión</button>
        </form>
        <div class="divider">O inicia sesión con</div>
        <button id="google-login-btn" class="provider-btn"><img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">Google</button>
        <button id="apple-login-btn" class="provider-btn"><img src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/icons/apple.svg" alt="Apple" style="filter: invert(1);">Apple</button>
        <div class="footer-links"><a href="/register.html">¿No tienes cuenta? Regístrate</a></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyBJkV7des2EtFX6EHJLUyzHJIvG7P86zGE", authDomain: "desarrolloenlanube-34667-816f5.firebaseapp.com", projectId: "desarrolloenlanube-34667-816f5", storageBucket: "desarrolloenlanube-34667-816f5.appspot.com", messagingSenderId: "438315579198", appId: "1:438315579198:web:51bcb77a9789c1981ade6f" };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        auth.onAuthStateChanged(user => {
            if (user) {
                db.collection('usuarios').doc(user.uid).get().then(doc => {
                    if (doc.exists && doc.data().rol === 'admin') {
                        window.location.href = '/admin.html';
                    } else {
                        window.location.href = '/index.html';
                    }
                }).catch(() => { window.location.href = '/index.html'; });
            }
        });

        const handleAuth = (promise) => {
            promise.then(result => {
                const user = result.user;
                const userRef = db.collection('usuarios').doc(user.uid);
                return userRef.get().then(doc => {
                    if (!doc.exists) {
                        return userRef.set({ email: user.email, rol: 'cliente' });
                    }
                });
            }).catch(err => {
                document.getElementById('error-message').textContent = err.message;
            });
        };

        document.getElementById('login-form').addEventListener('submit', e => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            handleAuth(auth.signInWithEmailAndPassword(email, password));
        });

        document.getElementById('google-login-btn').addEventListener('click', () => {
            const provider = new firebase.auth.GoogleAuthProvider();
            handleAuth(auth.signInWithPopup(provider));
        });

        document.getElementById('apple-login-btn').addEventListener('click', () => {
            const provider = new firebase.auth.OAuthProvider('apple.com');
            handleAuth(auth.signInWithPopup(provider));
        });
    </script>
</body>
</html>